<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ½å¥–æ´»åŠ¨ - ä¸»æŒäºº</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>

<body>
    <div class="container">
        <h1>ğŸ‰ æ‰«ç å‚ä¸æŠ½å¥–</h1>

        <div class="qr-card">
            <div style="margin-bottom: 15px;">
                <label for="ipInput" style="color:#ddd; font-size:0.9rem;">æœåŠ¡å™¨ IP åœ°å€:</label>
                <input type="text" id="ipInput" value="" placeholder="ä¾‹å¦‚ 192.168.1.5"
                    style="padding:5px; border-radius:5px; border:none; text-align:center; width: 150px;">
                <button onclick="updateQR()"
                    style="padding:5px 10px; cursor:pointer; background:var(--gold); border:none; border-radius:5px; font-weight:bold;">ç”Ÿæˆ</button>
            </div>

            <div id="qrcode" class="qr-placeholder"></div>
            <p class="instruction">è¯·ç¡®ä¿æ‰‹æœºå’Œç”µè„‘è¿æ¥åŒä¸€ WiFi</p>
            <p style="margin-top: 10px; font-size: 0.9rem; opacity: 0.7;">æ‰«ç åœ°å€: <span id="urlDisplay"></span></p>
        </div>
    </div>

    <script>
        const qrContainer = document.getElementById("qrcode");
        const ipInput = document.getElementById("ipInput");
        const urlDisplay = document.getElementById("urlDisplay");
        const ipContainer = document.querySelector(".qr-card > div:first-child"); // Container for the input

        // Helper to check if we are on a local network
        const hostname = window.location.hostname;
        const isLocal = hostname === '127.0.0.1' ||
            hostname === 'localhost' ||
            hostname.startsWith('192.168.') ||
            hostname.startsWith('10.') ||
            hostname.startsWith('172.');

        // Initialize based on environment
        if (!isLocal && hostname && !hostname.startsWith('file')) {
            // We are on a public domain (like GitHub), hide the IP manual input to avoid confusion
            if (ipContainer) ipContainer.style.display = 'none';
            ipInput.value = hostname;

            // Also hide the wifi instruction since it's not relevant for public web
            const wifiInstruction = document.querySelector(".instruction");
            if (wifiInstruction) wifiInstruction.style.display = 'none';
        } else {
            // Local environment, show input
            if (hostname && hostname !== '127.0.0.1' && hostname !== 'localhost') {
                ipInput.value = hostname;
            } else {
                ipInput.value = "127.0.0.1";
            }
        }

        function updateQR() {
            const ip = ipInput.value.trim() || window.location.hostname;
            const port = window.location.port ? ':' + window.location.port : '';
            // Construct URL
            const playUrl = `${window.location.protocol}//${ip}${port}/play.html`;

            qrContainer.innerHTML = "";
            new QRCode(qrContainer, {
                text: playUrl,
                width: 250,
                height: 250,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
            urlDisplay.textContent = playUrl;
        }

        updateQR();
    </script>
</body>

</html>